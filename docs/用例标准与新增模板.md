# 用例标准与新增模板（核心用例）

适用范围：当前项目的核心接口用例（Admin/EduPC/H5）。

## 1. 命名与注释标准

- 文件名：`test_<端>_<业务>.py`，如 `test_admin_add_audio.py`
- 测试函数名：`test_<端>_<业务>_<动作>`
- 文件头注释统一保留：
  - `用例 ID: 19位数字`
  - `用例名称: xxx`
  - `接口: METHOD /path`

示例：

```python
"""
用例 ID: 1150695810001062392
用例名称: 管理后台正常添加音频课程
接口: POST /ajax/wxAppAudio_h.jsp?cmd=add
"""
```

## 2. 用例结构标准（固定三段）

- **Arrange**：准备测试数据（来自 `TestDataManager` / `DataFactory`）
- **Act**：调用 action/client 执行业务动作
- **Assert**：只断言核心成功条件

## 3. 断言标准（核心场景）

- 每条用例至少包含：
  1) 一条接口成功断言（建议在 action/client 层统一 `assert_success`）
  2) 一条关键业务字段断言（如 `id`、`orderNo`、`orderItemId`）
- 可选增加 1 条关键字段一致性断言（如 name 匹配）
- 不要求边界值、异常流、跨端一致性扩展断言

## 4. 日志标准

- 使用 `logger.info("xxx=%s", value)` 结构化日志
- 不在测试中打印冗长响应体
- 失败信息在断言中明确业务点，不写无关执行细节

## 5. 数据标准（轻量数据工厂）

- 原子配置放在 `config/test_data.json`
- 读取入口：
  - `TestDataManager`：读取服务ID、金额、文件ID、模板
  - `DataFactory`：组装订单/退款等复用请求参数
- 禁止在新用例中新增硬编码魔法值（如默认 stuId、unionUserId）

## 6. 新增用例模板

```python
"""
用例 ID: 1150695810001XXXXXXXX
用例名称: 管理后台正常添加XXX
接口: POST /xxx
"""
from actions.xxx_actions import XxxActions
from test_data_manager import TestDataManager


def test_admin_add_xxx(admin_client, timestamp):
    """管理后台添加XXX - 核心创建流程"""

    # Arrange
    name = f"接口测试XXX_{timestamp}"
    test_data = TestDataManager.get_service_data("xxx", "admin")

    # Act
    result = XxxActions.create_xxx(admin_client, name=name, **test_data)

    # Assert
    assert result.get("id"), "XXX创建失败，id为空"
```

## 7. 环境策略（仅 dep 验收）

如果当前只在 `dep` 验收，**不需要完整多环境分层**。  
建议保留“最小分层能力”：

- 维持一套 `config/*.json` 本地配置
- 所有敏感与可变参数支持环境变量覆盖
- 约定 `DEP` 的固定执行命令与入口

这样后续要扩到 `staging/prod-like` 时，只需补配置，不用重构代码。
