# æ•°æ®æ¸…ç†æœºåˆ¶è¯´æ˜

## æ¦‚è¿°

ä¸ºç¡®ä¿æµ‹è¯•ç¯å¢ƒçš„æ•´æ´å’Œæµ‹è¯•çš„ç‹¬ç«‹æ€§ï¼Œæ‰€æœ‰åˆ›å»ºç±»æµ‹è¯•ç”¨ä¾‹éƒ½åº”è¯¥åœ¨æµ‹è¯•å®Œæˆåæ¸…ç†åˆ›å»ºçš„æ•°æ®ã€‚

## è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰åˆ é™¤æ“ä½œé›†ä¸­åœ¨ `DeleteActions` ç±»ä¸­ï¼Œé¿å…ä»£ç å†—ä½™
2. **è‡ªåŠ¨æ¸…ç†**ï¼šä½¿ç”¨ `try/finally` æ¨¡å¼ç¡®ä¿å³ä½¿æµ‹è¯•å¤±è´¥ä¹Ÿèƒ½æ¸…ç†æ•°æ®
3. **ç±»å‹å®‰å…¨**ï¼šæ¯ä¸ªèµ„æºç±»å‹éƒ½æœ‰å¯¹åº”çš„åˆ é™¤æ–¹æ³•ï¼Œå‚æ•°æ˜ç¡®

## DeleteActions ç±»

ä½ç½®ï¼š`api_tests/actions/delete_actions.py`

### æ”¯æŒçš„èµ„æºç±»å‹

| èµ„æºç±»å‹ | åˆ é™¤æ–¹æ³• | æ¥å£ |
|---------|---------|------|
| çº¿ä¸‹è¯¾ç¨‹ | `delete_offline_course(admin_client, course_id)` | `/ajax/eduCourse_h.jsp?cmd=delCourse` |
| ç³»åˆ—è¯¾ | `delete_column(admin_client, column_id)` | `/ajax/wxAppColumn_h.jsp?cmd=delColumn` |
| å›¾æ–‡è¯¾ç¨‹ | `delete_news(admin_client, news_id)` | `/ajax/wxAppNews_h.jsp?cmd=delNews` |
| éŸ³é¢‘è¯¾ç¨‹ | `delete_audio(admin_client, audio_id)` | `/ajax/wxAppAudio_h.jsp?cmd=del` |
| è§†é¢‘è¯¾ç¨‹ | `delete_video(admin_client, video_id)` | `/ajax/video_h.jsp?cmd=delVideo` |
| ç”µå­ä¹¦ | `delete_ebook(admin_client, ebook_id)` | `/api/manage/electronicBook/delElectronicBook` |
| è¯¾å¤–æœåŠ¡ | `delete_book_service(admin_client, service_id)` | `/api/manage/book/delBookService` |
| å®ç‰©å•†å“ | `delete_product(admin_client, product_id)` | `/ajax/eduProduct_h.jsp?cmd=delProduct` |
| é¢˜åº“ | `delete_question_bank(admin_client, bank_id)` | `/api/manage/batchOpt/del` (serviceType=25) |
| ä½œä¸š | `delete_homework(admin_client, homework_id)` | `/ajax/eduHomework_h.jsp?cmd=delHomework` |
| æ‰“å¡æ´»åŠ¨ | `delete_checkpoint(admin_client, checkpoint_id)` | `/ajax/checkpoint_h.jsp?cmd=delCheckpoint` |
| æµ‹è¯„ | `delete_evaluation(admin_client, evaluation_id)` | `/api/manage/batchOpt/del` (serviceType=24) |
| è¡¨å• | `delete_form(admin_client, form_id)` | `/ajax/wxAppForm_h.jsp?cmd=delWXAppForm` |
| ä¼˜æƒ åˆ¸ | `delete_coupon(admin_client, coupon_id)` | `/ajax/coupon_h.jsp?cmd=delCoupon` |
| å…‘æ¢ç  | `delete_redemption_code(admin_client, code_id)` | å…ˆå¤±æ•ˆå†åˆ é™¤ï¼ˆä¸¤æ­¥æ“ä½œï¼‰ |
| ç§»åŠ¨ç«¯è‡ªå®šä¹‰é¡µé¢ | `DesignerActions.delete_mobile_custom_page(admin_client, col_id)` | `/ajax/wxAppCol_h.jsp?cmd=delColInfo` |
| EduPCè®¾è®¡å™¨æ ç›® | `DesignerActions.delete_column(edupc_designer_client, col_id)` | `/ajax/col_h.jsp?cmd=setWafCk_multiSet` |

## ä½¿ç”¨ç¤ºä¾‹

### ç®¡ç†åå°åˆ›å»ºç±»ç”¨ä¾‹

```python
"""
ç”¨ä¾‹ ID: 1150695810001062389
ç”¨ä¾‹åç§°: ç®¡ç†åå°æ­£å¸¸åˆ›å»ºçº¿ä¸‹è¯¾ç¨‹
"""
from actions.delete_actions import DeleteActions


def test_admin_add_offline_course(admin_client, timestamp):
    """ç®¡ç†åå°åˆ›å»ºçº¿ä¸‹è¯¾ç¨‹ - éªŒè¯åˆ›å»ºæˆåŠŸ"""
    course_id = None

    try:
        # Act: åˆ›å»ºçº¿ä¸‹è¯¾ç¨‹
        result = admin_client.post(
            "/ajax/eduCourse_h.jsp",
            params={"cmd": "addCourse"},
            data={
                "courseName": f"æ¥å£æµ‹è¯•çº¿ä¸‹è¯¾_{timestamp}",
                # ... å…¶ä»–å‚æ•°
            },
        )

        # Assert: éªŒè¯åˆ›å»ºæˆåŠŸ
        admin_client.assert_success(result, "åˆ›å»ºçº¿ä¸‹è¯¾ç¨‹å¤±è´¥")
        course_id = result.get("data", {}).get("id") or result.get("id")
        assert course_id, "çº¿ä¸‹è¯¾ç¨‹åˆ›å»ºå¤±è´¥"
    finally:
        # æ¸…ç†ï¼šåˆ é™¤åˆ›å»ºçš„çº¿ä¸‹è¯¾ç¨‹
        if course_id:
            DeleteActions.delete_offline_course(admin_client, course_id)
```

### ç§»åŠ¨ç«¯è®¾è®¡å™¨ç”¨ä¾‹

```python
"""
ç”¨ä¾‹ ID: 1150695810001062419
ç”¨ä¾‹åç§°: ç§»åŠ¨ç«¯è®¾è®¡å™¨æ­£å¸¸æ·»åŠ è‡ªå®šä¹‰é¡µé¢å’Œå¸¸ç”¨æ¨¡å—
"""
from actions.designer_actions import DesignerActions


def test_mobile_designer_common(admin_client):
    """ç§»åŠ¨ç«¯è®¾è®¡å™¨ï¼šæ–°å¢é¡µé¢ + å¸¸ç”¨æ¨¡å—ä¿å­˜é“¾è·¯"""
    col_id = DesignerActions.add_mobile_custom_page(admin_client)

    try:
        # ... æµ‹è¯•é€»è¾‘ ...
        
        # Assert: éªŒè¯ä¿å­˜æˆåŠŸ
        saved_modules = saved_page_data.get("moduleList", [])
        assert len(saved_modules) > 0, "ä¿å­˜å moduleList ä¸ºç©º"
    finally:
        # æ¸…ç†ï¼šåˆ é™¤è‡ªå®šä¹‰é¡µé¢
        if col_id:
            DesignerActions.delete_mobile_custom_page(admin_client, col_id)
```

### EduPCè®¾è®¡å™¨ç”¨ä¾‹

```python
"""
ç”¨ä¾‹ ID: 1150695810001062418
ç”¨ä¾‹åç§°: edupcè®¾è®¡å™¨æ­£å¸¸æ·»åŠ è¡¨å•å’Œç­”é¢˜æ¨¡å—
"""
from actions.designer_actions import DesignerActions


def test_edupc_designer_add_form_and_answer_module(edupc_designer_client, edupc_client):
    """EduPC è®¾è®¡å™¨å®Œæ•´é“¾è·¯ï¼šæ–°å¢æ ç›® -> æ¨¡å—é…ç½® -> Cç«¯é¢„è§ˆ"""
    col_id = None
    
    try:
        # 1) æ–°å¢æ ç›®
        column_name = DesignerActions.build_unique_column_name()
        col_id = DesignerActions.add_column(edupc_designer_client, column_name=column_name)
        
        # ... æµ‹è¯•é€»è¾‘ ...
        
        # Assert: éªŒè¯é¢„è§ˆæˆåŠŸ
        assert "module" in payload_str.lower(), "é¢„è§ˆç»“æœä¸­æœªè¯†åˆ«åˆ°æ¨¡å—æ•°æ®"
    finally:
        # æ¸…ç†ï¼šåˆ é™¤åˆšæ–°å¢æ ç›®
        if col_id:
            DesignerActions.delete_column(edupc_designer_client, col_id=col_id)
```

## å…³é”®è¦ç‚¹

1. **ID å˜é‡åˆå§‹åŒ–**ï¼šåœ¨ `try` å—ä¹‹å‰å°†èµ„æº ID åˆå§‹åŒ–ä¸º `None`
   ```python
   course_id = None
   try:
       # ... åˆ›å»ºé€»è¾‘ ...
       course_id = result.get("id")
   finally:
       if course_id:  # åªæœ‰æˆåŠŸåˆ›å»ºæ‰æ¸…ç†
           DeleteActions.delete_offline_course(admin_client, course_id)
   ```

2. **æ¡ä»¶æ¸…ç†**ï¼šåœ¨ `finally` å—ä¸­ä½¿ç”¨ `if resource_id:` åˆ¤æ–­ï¼Œé¿å…åˆ é™¤ä¸å­˜åœ¨çš„èµ„æº

3. **ç‰¹æ®Šæƒ…å†µ**ï¼š
   - **å­¦å‘˜**ï¼šä½¿ç”¨å›ºå®šæµ‹è¯•å­¦å‘˜ï¼Œä¸éœ€è¦åˆ é™¤
   - **ç­”é¢˜æ´»åŠ¨**ï¼šä½¿ç”¨å›ºå®šæµ‹è¯•æ´»åŠ¨ï¼Œä¸éœ€è¦åˆ é™¤
   - **æµ‹è¯„æ´»åŠ¨**ï¼šä¸šåŠ¡é€»è¾‘ç‰¹æ®Šï¼Œæš‚ä¸æ¸…ç†æµ‹è¯•æ•°æ®
   - **å…‘æ¢ç **ï¼šä¸šåŠ¡é€»è¾‘ç‰¹æ®Šï¼Œæš‚ä¸æ¸…ç†æµ‹è¯•æ•°æ®

## å·²å®Œæˆæ¸…ç†çš„ç”¨ä¾‹

### ç®¡ç†åå°ï¼ˆå·²å®Œæˆ 13/17ï¼‰
- âœ… `test_admin_add_offline_course.py` - çº¿ä¸‹è¯¾ç¨‹
- âœ… `test_admin_add_video.py` - è§†é¢‘è¯¾ç¨‹
- âœ… `test_admin_add_audio.py` - éŸ³é¢‘è¯¾ç¨‹
- âœ… `test_admin_add_news.py` - å›¾æ–‡è¯¾ç¨‹
- âœ… `test_admin_add_column.py` - ç³»åˆ—è¯¾
- âœ… `test_admin_add_form.py` - è¡¨å•
- âœ… `test_admin_add_ebook.py` - ç”µå­ä¹¦
- âœ… `test_admin_add_book_service.py` - è¯¾å¤–æœåŠ¡
- âœ… `test_admin_add_product.py` - å®ç‰©å•†å“
- âœ… `test_admin_add_question_bank.py` - é¢˜åº“
- âœ… `test_admin_add_homework.py` - ä½œä¸š
- âœ… `test_admin_add_checkpoint.py` - æ‰“å¡æ´»åŠ¨
- âœ… `test_admin_add_coupon.py` - ä¼˜æƒ åˆ¸
- ğŸ”¸ `test_admin_add_evaluation.py` - æµ‹è¯„ï¼ˆç‰¹æ®Šä¸šåŠ¡ï¼Œæš‚ä¸æ¸…ç†ï¼‰
- ğŸ”¸ `test_admin_add_redemption_code.py` - å…‘æ¢ç ï¼ˆç‰¹æ®Šä¸šåŠ¡ï¼Œæš‚ä¸æ¸…ç†ï¼‰
- ğŸ”¸ `test_admin_add_answer_activity.py` - ç­”é¢˜æ´»åŠ¨ï¼ˆä½¿ç”¨å›ºå®šæ•°æ®ï¼‰
- ğŸ”¸ `test_admin_add_student.py` - å­¦å‘˜ï¼ˆä½¿ç”¨å›ºå®šæ•°æ®ï¼‰

### ç§»åŠ¨ç«¯è®¾è®¡å™¨ï¼ˆå·²å®Œæˆ 4/4ï¼‰
- âœ… `test_mobile_designer_common.py` - å¸¸ç”¨æ¨¡å—
- âœ… `test_mobile_designer_course.py` - è¯¾ç¨‹æ¨¡å—
- âœ… `test_mobile_designer_study.py` - åŠ©å­¦äº’åŠ¨æ¨¡å—
- âœ… `test_mobile_designer_marketing.py` - è¥é”€æ¨¡å—

### EduPCè®¾è®¡å™¨ï¼ˆå·²å®Œæˆ 3/3ï¼‰
- âœ… `test_edupc_designer_add_form_and_answer_module_preview.py`
- âœ… `test_edupc_designer_add_basic_layout_modules_preview.py`
- âœ… `test_edupc_designer_add_course_modules_preview.py`

## æ— éœ€æ¸…ç†çš„ç”¨ä¾‹

### ç®¡ç†åå°ï¼ˆç‰¹æ®Šæƒ…å†µ 2/17ï¼‰
- ğŸ”¸ `test_admin_add_answer_activity.py` - ç­”é¢˜æ´»åŠ¨ï¼ˆä½¿ç”¨å›ºå®šæµ‹è¯•æ´»åŠ¨ï¼Œæ— éœ€æ¸…ç†ï¼‰
- ğŸ”¸ `test_admin_add_student.py` - å­¦å‘˜ï¼ˆä½¿ç”¨å›ºå®šæµ‹è¯•å­¦å‘˜ï¼Œæ— éœ€æ¸…ç†ï¼‰

## æ‰©å±•æŒ‡å—

å¦‚éœ€æ·»åŠ æ–°çš„åˆ é™¤æ–¹æ³•ï¼š

1. åœ¨ `DeleteActions` ç±»ä¸­æ·»åŠ é™æ€æ–¹æ³•
2. å‚è€ƒç°æœ‰æ–¹æ³•çš„å‘½åå’Œå‚æ•°é£æ ¼
3. æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²è¯´æ˜æ¥å£è·¯å¾„
4. ä½¿ç”¨ `admin_client.assert_success()` è¿›è¡Œç»“æœæ–­è¨€
5. æ›´æ–°æœ¬æ–‡æ¡£çš„"æ”¯æŒçš„èµ„æºç±»å‹"è¡¨æ ¼

## æµ‹è¯•éªŒè¯

æ‰€æœ‰æ·»åŠ æ¸…ç†é€»è¾‘çš„ç”¨ä¾‹éƒ½å·²é€šè¿‡æµ‹è¯•éªŒè¯ï¼š
- åˆ›å»ºæ“ä½œæˆåŠŸ
- æ¸…ç†æ“ä½œæˆåŠŸ
- TAPD è‡ªåŠ¨ä¸ŠæŠ¥æ­£å¸¸
