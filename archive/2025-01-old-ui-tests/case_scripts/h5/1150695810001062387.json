{
  "caseId": "1150695810001062387",
  "name": "H5正常注册学员",
  "group": "h5",
  "needsLogin": "none",
  "steps": [
    {
      "action": "goto",
      "url": "http://huaedu1-110.m.365hjy.com.faidev.cc/webIndex.jsp#/loginPages/pwdLogin/pwdLogin"
    },
    {
      "action": "wait",
      "ms": 5000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const logoutBtn = doc.querySelector('text=退出登录') || Array.from(doc.querySelectorAll('span, div, button, a')).find(el => el.textContent.includes('退出')); if(logoutBtn) logoutBtn.click(); }",
      "description": "尝试退出已有登录（如果已登录）"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "goto",
      "url": "http://huaedu1-110.m.365hjy.com.faidev.cc/webIndex.jsp#/loginPages/pwdLogin/pwdLogin"
    },
    {
      "action": "wait",
      "ms": 5000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const personalCenter = Array.from(doc.querySelectorAll('a, div, span')).find(el => el.textContent.includes('个人中心')); if(personalCenter) { personalCenter.click(); } }",
      "description": "如已登录，先进个人中心准备退出"
    },
    {
      "action": "wait",
      "ms": 3000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; doc.documentElement.scrollTop = doc.documentElement.scrollHeight; const body = doc.body; if(body) body.scrollTop = body.scrollHeight; const scrollEl = doc.querySelector('.page-content, .scroll-view, [class*=scroll]'); if(scrollEl) scrollEl.scrollTop = scrollEl.scrollHeight; }",
      "description": "滚动到页面底部找退出按钮"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const logoutBtn = Array.from(doc.querySelectorAll('div, span, button, a')).find(el => el.textContent.trim() === '退出登录' || el.textContent.trim() === '退出'); if(logoutBtn) logoutBtn.click(); }",
      "description": "点击退出登录按钮"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const confirmBtn = Array.from(doc.querySelectorAll('div, span, button, a')).find(el => el.textContent.trim() === '确定' || el.textContent.trim() === '确认'); if(confirmBtn) confirmBtn.click(); }",
      "description": "确认退出弹窗"
    },
    {
      "action": "wait",
      "ms": 3000
    },
    {
      "action": "goto",
      "url": "http://huaedu1-110.m.365hjy.com.faidev.cc/webIndex.jsp#/loginPages/register/register"
    },
    {
      "action": "wait",
      "ms": 5000
    },
    {
      "action": "iframe",
      "iframeSelector": "#mainIframe",
      "steps": [
        {
          "action": "fill",
          "selector": "input[placeholder*='账号'], input[placeholder*='用户名'], input[type='text']:first-of-type",
          "value": "km{timestamp}",
          "description": "填写注册账号（km+时间戳）"
        },
        {
          "action": "fill",
          "selector": "input[placeholder*='密码'], input[type='password']:first-of-type",
          "value": "123456",
          "description": "填写密码"
        }
      ],
      "description": "在iframe内填写注册信息"
    },
    {
      "action": "wait",
      "ms": 1000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const pwdInputs = doc.querySelectorAll('input[type=\"password\"]'); if(pwdInputs.length >= 2) { const el = pwdInputs[1]; el.focus(); el.value = '123456'; el.dispatchEvent(new Event('input', {bubbles:true})); el.dispatchEvent(new Event('change', {bubbles:true})); el.blur(); } }",
      "description": "填写确认密码（如有第二个密码框）"
    },
    {
      "action": "wait",
      "ms": 1000
    },
    {
      "action": "iframeClick",
      "iframeSelector": "#mainIframe",
      "selector": "text=/(注册|立即注册)/",
      "description": "点击注册按钮"
    },
    {
      "action": "wait",
      "ms": 5000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const nameInput = doc.querySelector('input[placeholder*=\"姓名\"], input[placeholder*=\"昵称\"]'); if(nameInput) { nameInput.focus(); nameInput.value = 'H5注册' + Date.now().toString().slice(-6); nameInput.dispatchEvent(new Event('input', {bubbles:true})); nameInput.dispatchEvent(new Event('change', {bubbles:true})); } }",
      "description": "完善个人信息-填写姓名"
    },
    {
      "action": "wait",
      "ms": 1000
    },
    {
      "action": "evaluate",
      "script": "const iframe = document.querySelector('#mainIframe'); if(iframe) { const doc = iframe.contentDocument; const submitBtn = Array.from(doc.querySelectorAll('button, div, span, a')).find(el => el.textContent.trim() === '提交' || el.textContent.trim() === '完成' || el.textContent.trim() === '保存'); if(submitBtn) submitBtn.click(); }",
      "description": "提交完善信息"
    },
    {
      "action": "wait",
      "ms": 3000
    },
    {
      "action": "verify",
      "expect": "注册成功|个人中心|首页|提交成功",
      "snapshot": true,
      "description": "验证H5正常注册学员成功"
    }
  ],
  "cleanup": null,
  "verify": "注册成功|个人中心|首页|提交成功"
}
