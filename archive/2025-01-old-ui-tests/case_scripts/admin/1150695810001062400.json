{
  "caseId": "1150695810001062400",
  "name": "管理后台正常添加打卡活动",
  "group": "admin",
  "needsLogin": "admin",
  "steps": [
    {
      "action": "goto",
      "url": "http://i.edu.fkw.com.faidev.cc/?__aacct=huaedu1#/assistance/checkPoint"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "click",
      "selector": "button:has-text('添加活动')",
      "fallbacks": ["text=添加活动"],
      "description": "点击添加活动按钮"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "evaluate",
      "script": "const input = document.querySelector('input[type=\"text\"]'); if(input) { input.focus(); input.value = '打卡活动' + Date.now().toString().slice(-8); input.dispatchEvent(new Event('input', {bubbles:true})); input.dispatchEvent(new Event('change', {bubbles:true})); }",
      "description": "输入活动名称（用 input[type=text]）"
    },
    {
      "action": "selectResource",
      "type": "image",
      "description": "添加封面图片"
    },
    {
      "action": "wait",
      "ms": 1000
    },
    {
      "action": "evaluate",
      "script": "const iframes = document.querySelectorAll('iframe'); for(const iframe of iframes) { try { const body = iframe.contentDocument.querySelector('body'); if(body && body.getAttribute('contenteditable') !== 'false') { body.innerHTML = '<p>打卡活动介绍内容</p>'; body.dispatchEvent(new Event('input', {bubbles:true})); break; } } catch(e) {} }",
      "description": "输入活动介绍"
    },
    {
      "action": "wait",
      "ms": 500
    },
    {
      "action": "evaluate",
      "script": "const tabs = document.querySelectorAll('.el-tabs__item'); for(const t of tabs) { if(t.textContent.includes('打卡任务')) { t.click(); break; } }",
      "description": "切换到打卡任务tab"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "click",
      "selector": "button:has-text('添加任务')",
      "fallbacks": ["text=添加任务"],
      "description": "点击添加任务按钮"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "fill",
      "selector": "input[placeholder*='任务名称']",
      "value": "打卡任务{timestamp}",
      "fallbacks": ["input[placeholder*='请输入任务名称']", "input[placeholder*='名称']"],
      "description": "输入任务名称"
    },
    {
      "action": "evaluate",
      "script": "const iframes = document.querySelectorAll('iframe'); let count = 0; for(const iframe of iframes) { try { const body = iframe.contentDocument.querySelector('body'); if(body && body.getAttribute('contenteditable') !== 'false') { count++; if(count >= 2) { body.innerHTML = '<p>任务详情内容</p>'; body.dispatchEvent(new Event('input', {bubbles:true})); break; } } } catch(e) {} }",
      "description": "输入任务详情"
    },
    {
      "action": "wait",
      "ms": 500
    },
    {
      "action": "evaluate",
      "script": "const dialogs = document.querySelectorAll('.el-dialog__wrapper'); for(const d of dialogs) { if(d.style.display !== 'none') { const btn = d.querySelector('.el-dialog__footer button.el-button--primary'); if(btn) { btn.click(); break; } } }",
      "description": "点击任务弹窗保存按钮"
    },
    {
      "action": "wait",
      "ms": 1500
    },
    {
      "action": "click",
      "selector": "button:has-text('保存')",
      "fallbacks": ["button:has-text('保 存')", ".footer button.el-button--primary"],
      "force": true,
      "description": "点击最外层保存按钮"
    },
    {
      "action": "wait",
      "ms": 2000
    },
    {
      "action": "verify",
      "expect": "保存成功|操作成功|创建成功|打卡活动",
      "snapshot": true,
      "description": "验证正常创建打卡活动"
    }
  ],
  "cleanup": null,
  "verify": "保存成功|操作成功|创建成功"
}
