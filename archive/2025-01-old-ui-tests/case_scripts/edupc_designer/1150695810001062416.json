{
  "caseId": "1150695810001062416",
  "name": "edupc设计器正常添加自定义栏目以及课程模块，访客态正常预览",
  "group": "edupc_designer",
  "needsLogin": "admin",
  "steps": [
    { "action": "goto", "url": "http://huaedu1-110.edu.fkw.com.faidev.cc/" },
    { "action": "wait", "ms": 2000 },
    {
      "action": "evaluate",
      "script": "await page.locator('*').filter({ hasText: /编辑顶部|Training/ }).first().hover(); await page.waitForTimeout(600);",
      "description": "hover顶部导航栏显示管理栏目菜单"
    },
    {
      "action": "click",
      "selector": "*:has-text('管理栏目')",
      "fallbacks": ["text=管理栏目"],
      "description": "定位管理栏目区域"
    },
    {
      "action": "evaluate",
      "script": "const el = page.locator('*').filter({ hasText: '管理栏目' }).locator('..').getByRole('button', { name: /添加|add|\\+/ }).first(); await el.click();",
      "description": "点击管理栏目旁的加号添加新栏目"
    },
    { "action": "wait", "ms": 1000 },
    {
      "action": "evaluate",
      "script": "const iframes = await page.locator('iframe').all(); for (const iframe of iframes) { const frame = await iframe.contentFrame(); if (!frame) continue; const nameInput = frame.locator('input[type=\"text\"]').first(); if (await nameInput.count() === 0) continue; await nameInput.fill('自定义栏目' + Date.now().toString().slice(-6)); await nameInput.dispatchEvent('input'); await nameInput.dispatchEvent('change'); await nameInput.evaluate(el => el.blur()); break; }",
      "description": "iframe内填写栏目名称并blur使保存按钮可用"
    },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "button:has-text('保 存')", "force": true },
    { "action": "wait", "ms": 2000 },
    {
      "action": "click",
      "selector": ".add_module_item_courseVideo, text=视频",
      "fallbacks": ["text=课程", "text=视频"],
      "description": "左侧课程tab下点击视频"
    },
    { "action": "wait", "ms": 500 },
    {
      "action": "click",
      "selector": "text=选择视频",
      "fallbacks": ["button:has-text('选择视频')"]
    },
    { "action": "wait", "ms": 1500 },
    {
      "action": "evaluate",
      "script": "for (const iframe of await page.locator('iframe').all()) { const frame = await iframe.contentFrame(); if (!frame) continue; const item = frame.locator('text=km付费视频').first(); if (await item.count() > 0) { await item.click(); break; } }",
      "description": "iframe内选择任一视频"
    },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "button:has-text('确 定')", "force": true },
    { "action": "wait", "ms": 1000 },
    {
      "action": "click",
      "selector": ".funPanelEntryBtnSvg, [class*='add_module']",
      "fallbacks": ["getByRole('img').nth(5)"],
      "description": "右下角模块图标打开左侧面板"
    },
    { "action": "click", "selector": ".add_module_item_courseAudio, text=音频" },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "text=选择音频" },
    { "action": "wait", "ms": 1500 },
    {
      "action": "evaluate",
      "script": "for (const iframe of await page.locator('iframe').all()) { const frame = await iframe.contentFrame(); if (!frame) continue; const item = frame.locator('text=km付费音频').first(); if (await item.count() > 0) { await item.click(); break; } }",
      "description": "iframe内选择任一音频"
    },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "button:has-text('确 定')", "force": true },
    { "action": "wait", "ms": 1000 },
    { "action": "click", "selector": ".add_module_item_courseImgText, text=图文" },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "text=选择图文" },
    { "action": "wait", "ms": 1500 },
    {
      "action": "evaluate",
      "script": "for (const iframe of await page.locator('iframe').all()) { const frame = await iframe.contentFrame(); if (!frame) continue; const item = frame.locator('text=km付费图文').first(); if (await item.count() > 0) { await item.click(); break; } }",
      "description": "iframe内选择任一图文"
    },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "button:has-text('确 定')", "force": true },
    { "action": "wait", "ms": 1000 },
    { "action": "click", "selector": ".add_module_item_courseColumn, text=系列课" },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "text=选择系列课" },
    { "action": "wait", "ms": 1500 },
    {
      "action": "evaluate",
      "script": "for (const iframe of await page.locator('iframe').all()) { const frame = await iframe.contentFrame(); if (!frame) continue; const item = frame.locator('text=km付费系列课').first(); if (await item.count() > 0) { await item.click(); break; } }",
      "description": "iframe内选择任一系列课"
    },
    { "action": "wait", "ms": 500 },
    { "action": "click", "selector": "button:has-text('确 定')", "force": true },
    { "action": "wait", "ms": 1000 },
    { "action": "click", "selector": "text=保存", "fallbacks": ["button:has-text('保存')"] },
    { "action": "wait", "ms": 2000 },
    { "action": "click", "selector": "text=预览", "fallbacks": ["button:has-text('预览')"] },
    { "action": "wait", "ms": 3000 },
    {
      "action": "verify",
      "expect": "预览|访客|页面",
      "snapshot": true,
      "description": "验证设计器添加课程模块并预览成功"
    }
  ],
  "cleanup": null,
  "verify": "预览|访客|页面"
}
